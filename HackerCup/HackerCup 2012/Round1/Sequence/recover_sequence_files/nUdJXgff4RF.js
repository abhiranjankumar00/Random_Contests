/*1323666043,169776320*/

if (window.CavalryLogger) { CavalryLogger.start_js(["48vAQ"]); }

function Beeper(a){this._baseRoot=a;if(!FbDesktopPlugin.shouldSuppressBeeper())this._receiver=new LiveMessageReceiver(Beeper.BEEP_EVENT).setAppId(Beeper.APP_ID).setHandler(this.fromMessage.bind(this)).register();}copy_properties(Beeper,{BEEP_EVENT:'beep_event',APP_ID:30729425562,CONTENT_ID:'BeeperBox',DEFAULT_DELAY_MS:10000,DEFAULT_UNPAUSE_MS:500,SLIDE_DOWN_ANIMATION_MS:700,FADE_IN_ANIMATION_MS:500,FADE_OUT_ANIMATION_MS:1250,_instance:null,setInstance:function(a){Beeper._instance=a;},getInstance:function(){Beeper.ensureInitialized();return Beeper._instance;},ensureInitialized:function(){if(!Beeper._instance)Beeper.setInstance(new Beeper($(Beeper.CONTENT_ID)));}});copy_properties(Beeper.prototype,{beeps:[],reset:function(){this.beeps=[];if(this._root)DOM.remove(this._root);this._root=$(this._baseRoot.cloneNode(true));Event.listen(this._root,'mouseover',this.mouseover.bind(this));Event.listen(this._root,'mouseout',this.mouseout.bind(this));DOM.insertAfter(this._baseRoot,this._root);this._full=DOM.find(this._root,'div.UIBeeper_Full');this._inside=DOM.find(this._root,'div.Beeps');if(this._timer)clearInterval(this._timer);this._timer=null;this._animation=null;this._paused=0;Arbiter.inform(Notifications.BEEPS_EXPIRED);},mouseover:function(event){this.pause();this.markRead(true);},mouseout:function(event){this.unpause();},fromMessage:function(b){if(!this._root)this.reset();var a=new Beep(this,b);this.addBeep(a);},addBeep:function(a){this.beeps.push(a);a.setTop(true);if(this.beeps.length==1){a.setBottom(true);CSS.show(this._root);}else{a.setBottom(false);this.beeps[this.beeps.length-2].setTop(false);}this._restartTimer(Beeper.DEFAULT_DELAY_MS);DOM.prependContent(this._inside,a.getNode());a.fadeIn(Beeper.FADE_IN_ANIMATION_MS);},hasIncoming:function(){for(var a=0;a<this.beeps.length;a++)if(this.beeps[a].type=='NotificationBeep')return true;return false;},expireBeeps:function(){if(this.beeps.length<=0)return;this.fadeOut();},fadeOut:function(){this._animation=animation(this._full).duration(Beeper.FADE_OUT_ANIMATION_MS).to('opacity',0).blind().ease(animation.ease.begin).ondone(function(){this.reset();}.bind(this));this._animation.undo=function(){this._animation.stop();CSS.setStyle(this._full,'opacity',1);}.bind(this);this._animation.go();},markRead:function(c,b){if(!b){b=[];this.beeps.each(function(d){if(d.unread&&d.type=='NotificationBeep')b.push(d.alertId);});}var a=Object.from(b);this.beeps.each(function(d){if(a[d.alertId])d.markRead();});if(c&&b.length)window.presenceNotifications&&presenceNotifications.markRead(true,b);},pause:function(){if(this._animation&&this._animation.undo){this._animation.undo();this._animation=null;return;}this._pauseTimer();CSS.addClass(this._root,'UIBeeper_Paused');this._paused++;},_pauseTimer:function(){if(this._timer)clearInterval(this._timer);},unpause:function(a){if(!a)a=Beeper.DEFAULT_UNPAUSE_MS;this._paused--;if(this._paused<=0){CSS.removeClass(this._root,'UIBeeper_Paused');this._restartTimer(a);}},_restartTimer:function(a){if(this._timer)clearInterval(this._timer);this._timer=this.expireBeeps.bind(this).defer(a,false);},updateEdges:function(){if(this.beeps.length<=0)return;this.beeps[0].setBottom(true);this.beeps[this.beeps.length-1].setTop(true);}});