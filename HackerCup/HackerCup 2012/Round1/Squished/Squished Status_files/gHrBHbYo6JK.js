/*1327297838,176832697*/

if (window.CavalryLogger) { CavalryLogger.start_js(["0h+62"]); }

var FriendListMenu={init:function(c){Menu.register(c,false);var d=DOM.find(c,'.FriendListCreateTrigger');var b=DOM.find(c,'.CreateListInputItem');var a=DOM.find(b,'.createListInput');Menu.subscribe('select',function(e,f){if(f.item==d){CSS.addClass(c,'FriendListMenuCreate');Input.focus(a);}});Event.listen(a,'blur',function(e){if(Input.isEmpty(a))CSS.removeClass(c,'FriendListMenuCreate');});Event.listen(a,'keydown',function(e){if(Event.getKeyCode(e)==KEYS.RETURN&&/[^\s]/.test(a.value))new AsyncRequest().setURI('/ajax/friends/lists/create.php').setData({name:a.value,id:c.id}).setHandler(function(){Input.reset(a);CSS.removeClass(c,'FriendListMenuCreate');}).send();});Arbiter.subscribe('friend-list/new',function(h,e){var g=HTML(e.new_li).getRootNode();DOM.insertBefore(g,d);var f=DOM.find(g,'input');if(e.id===c.id){Menu.focusItem(g);Menu.inform('select',{menu:Parent.byClass(g,'uiMenu'),item:g});}else Menu.toggleItem(g);});}};
var RestrictedFriendListEducation=(function(){var b;var a;function c(e,d){if(d.flid==b)if(e=='FriendListHovercard/add'){if(a)return;a=true;new AsyncRequest().setURI('/ajax/friends/lists/restricted_edu.php').setData({target:d.uid,flid:d.flid}).send();}else if(e=='RestrictedListNUX/okay')new AsyncRequest().setURI('/ajax/friends/lists/nux_log.php').setData(d).send();return true;}return {init:function(d){b=d;Arbiter.subscribe(['FriendListHovercard/add','RestrictedListNUX/okay'],c);}};})();
var GroupMemberSelector=function(){};GroupMemberSelector.prototype.init=function(a,d,e,c,b){this._form=a;this._search=d;this._viewFilter=e;this._groupURI=b;this._orderField=c;Selector.listen(e,'change',this.onFilter.bind(this));Event.listen(a,'submit',this.onSubmit.bind(this));};GroupMemberSelector.prototype.onFilter=function(){this.onSubmit();};GroupMemberSelector.prototype.onSubmit=function(){var b=Selector.getValue(this._viewFilter)||'';var a=b.split('-');var c=a[0]||null;this._orderField.value=a[1]||null;if(c=='admins'){this._form.action=this._groupURI+'admins/';}else if(c=='blocked'){this._form.action=this._groupURI+'blocked/';}else this._form.action=this._groupURI+'members/';this._form.view.disabled=true;if(this._search.value==this._search.placeholder)this._form.query.disabled=true;goURI(URI(this._form.action).setQueryData(Form.serialize(this._form)));return false;};
var FBXEditExperience={initAddExperience:function(d,c,a,b){d&&d.subscribe('select',function(e,h){var f=d.getCore();f.setEnabled(false);var g=function(){f.reset();f.getElement().blur();f.setEnabled(true);};new AsyncRequest(a).setData({hub_id:h.selected.uid,hub_text:h.selected.text,type:c}).setHandler(g).setErrorHandler(function(i){g();AsyncResponse.defaultErrorHandler(i);}).setStatusElement(d.getElement().parentNode).setRelativeTo(b).send();});},initEditExperience:function(d,f,c){var b=c?Parent.byClass(d,'subexperience'):d,a=DOM.find(b,'.deleteForm');var e=Parent.byClass(d,'sortableExperienceList');Event.listen(d,'mouseup',function(g){var j=e&&CSS.hasClass(e,'fbxExperienceSorting');var i=g.getTarget(),h=false;while(i&&!h){h=DOM.isNode(i,['a','input','button','select','textarea','label']);i=i.parentNode;}if((Parent.byClass(g.getTarget(),'editForm')||!h)&&DOM.getSelection()===''&&!CSS.hasClass(b,'editFormLoading')&&!j){CSS.addClass(b,'editFormLoading');Form.bootstrap(DOM.find(b,'.editForm'));Arbiter.inform('experience_sort/disable',{section:f,disabled:true});}});Event.listen(DOM.find(a,'label'),'mouseover',function(g){CSS.removeClass(d,'hovered');g.kill();});Event.listen(b,'mouseover',function(){CSS.addClass(b,'hovered');});Event.listen(b,'mouseout',function(){CSS.removeClass(b,'hovered');});}};
function HubsTypeaheadView(a,b){this.parent.construct(this,a,b);}Class.extend(HubsTypeaheadView,'ContextualTypeaheadView');HubsTypeaheadView.prototype={render:function(f,d,e){if(this.alwaysRender&&f!==''){var c=f.toLowerCase().trim();var a=false;for(var b=0;b<d.length;b++)if(c==d[b].text.toLowerCase()){a=true;break;}if(!a)d.push({text:f,type:'calltoaction'});}return this.parent.render(f,d,e);}};
var TimelineFriendsTabHeader={init:function(b,a,d,c){this.header=b;this.count=a;this.subheader=DOM.find(b,'span.subheader');this.typeahead=d;this.selector=c;this.selector.subscribe('changeTarget',function(e,f){if(!this.header.disabled)this.updateFilter(f.value);}.bind(this));this.typeahead.subscribe('respond',function(e,f){if(!this.header.disabled)this.updateHeader(f.value,f.results,f.isAsync);}.bind(this));},setSubHeader:function(a){if(a){DOM.setContent(this.subheader,a);CSS.show(this.subheader);CSS.hide(this.count);}else{CSS.hide(this.subheader);CSS.show(this.count);}},updateHeader:function(c,a){var b;if(!c){b=null;}else if(!a||!a.length){b="Search (No Results)";}else if(a.length==1){b="Search (1 Result)";}else b=_tx("Search ({count} Results)",{count:a.length});this.setSubHeader(b);},updateFilter:function(b){var a;if(b){if(b=='Mutual Friends'){a="Mutual";}else if(b=='People You May Know'){a="People You May Know";}else if(b=='friends_of'){a="Search Friends Of";}else if(b=='currentcity'){a="Search by Current City";}else if(b=='school'){a="Search by School";}else if(b=='workplace'){a="Search by Workplace";}else if(b=='hometown'){a="Search by Hometown";}else if(b=='interest'){a="Search by Interest";}else a=null;this.setSubHeader(a);}else this.setSubHeader(null);}};
function ProfileBrowser(){}Class.mixin(ProfileBrowser,'Arbiter',{init:function(b,d,c,e,a){this.listView=b;this.target=d;this.selector=c;this.typeahead=e;this.hubs=a;this.subscribeListView();this.selector&&this.subscribeSelector();this.typeahead&&this.subscribeTypeahead();this.hubs&&this.subscribeHubs();},setSelectionLimit:function(a){this.selectionLimit=a;return this;},subscribeListView:function(){this.listView.subscribe('clickedCheckable',function(a,b){this.listView.toggleCheckableItem(b.item,!CSS.hasClass(b.item,'selectedCheckable'));}.bind(this));},subscribeSelector:function(){var a=this.typeahead&&this.typeahead.getCore();this.selector.subscribe('changeTarget',function(b,c){if(a){CSS.conditionShow(this.typeahead.getElement(),c.showtypeahead);a.getValue()&&a.reset();c.showtypeahead&&a.getElement().focus();}this.target=$(c.target);c.isprimer&&this.listView.setLoadingState(true);this.listView.swapList(this.target);this.hubs&&CSS.conditionShow(this.hubs.getElement(),c.hubs);}.bind(this));this.selector.subscribe('changeHub',function(b,e){var c=this.hubs.getCore();var d=c.getElement();this.hubs.init(this.hubBehaviors);this.hubs.swapData(this.hubsData[e.value]);c.reset();Input.setPlaceholder(d,e.placeholder);d.focus();this.hubendpoint=URI(e.endpoint);}.bind(this));},subscribeTypeahead:function(){this.typeahead.subscribe('render',function(){var a=this.typeahead.getCore().getValue()?this.typeahead.getView().element:this.target;this.listView.swapList(a);}.bind(this));this.typeahead.subscribe('reset',function(){this.listView.swapList(this.target);}.bind(this));this.typeahead.subscribe('activity',function(a,b){CSS.conditionClass(this.typeahead.getElement(),'loading',b.activity);}.bind(this));},subscribeHubs:function(){this.hubs.subscribe('select',function(a,b){this.hubendpoint.addQueryData({node:b.selected.uid,pagetext:b.selected.text,offset:0,target:this.target.id});CSS.addClass(this.hubs.getElement(),'hubsLoading');new AsyncRequest(this.hubendpoint).setReadOnly(true).setMethod('POST').setRelativeTo(this.selector.getSelectedAnchor()).setHandler(function(){CSS.removeClass(this.hubs.getElement(),'hubsLoading');}.bind(this)).send();}.bind(this));},addHubData:function(a){this.hubsData=copy_properties(this.hubsData,a);},addHubBehaviors:function(a){this.hubBehaviors=a;},getSelectionLimit:function(){return this.selectionLimit;}});
function SwitchableProfileBrowser(){this.parent.construct(this);}Class.extend(SwitchableProfileBrowser,'ProfileBrowser');SwitchableProfileBrowser.prototype={NORMAL:'normal',LARGE:'large',GRID:'grid',initViewButtons:function(a,b){this.viewButtons=a;this.subscribeViewButtons();},subscribeTypeahead:function(){this.typeahead.subscribe('render',function(){if(this.typeahead.getCore().getValue()){this.listView.swapList(this.typeahead.getView().element);this.viewButtons.setEnabled(false);}else{this.listView.swapList(this.target);this.viewButtons.setEnabled(true);}}.bind(this));this.typeahead.subscribe('reset',function(){this.listView.swapList(this.target);this.viewButtons.setEnabled(true);}.bind(this));this.typeahead.subscribe('activity',function(a,b){CSS.conditionClass(this.typeahead.getElement(),'loading',b.activity);}.bind(this));},subscribeViewButtons:function(){this.viewButtons.subscribe('swapView',function(a,d){var b=this.typeahead&&this.typeahead.getCore();b&&b.getValue()&&b.reset();var c=this.listView.getRoot();CSS.conditionClass(c,this.NORMAL,d.view==this.NORMAL);CSS.conditionClass(c,this.LARGE,d.view==this.LARGE);CSS.conditionClass(c,this.GRID,d.view==this.GRID);}.bind(this));}};
function ProfileBrowserListView(){}Class.mixin(ProfileBrowserListView,'Arbiter',{init:function(b,a,c){this._root=b;this._activeList=a;this._windowTrigger=c;Event.listen(b,'click',this._handleClick.bind(this));},resetScroll:function(){this._scroll&&this._scroll.remove();this._listenForScroll();},toggleCheckableItem:function(c,b){var a=DOM.find(c,'input.checkbox');a.checked=b;CSS.conditionClass(c,'selectedCheckable',b);var d=c.nextSibling||c.previousSibling;d&&CSS.addClass(d,'sib')&&CSS.removeClass(d,'sib');},setLoadingState:function(a){CSS.conditionClass(this._root,'showListviewLoading',a);},swapList:function(a){CSS.addClass(this._activeList,'hiddenList');this._activeList=a;CSS.show(this._activeList);CSS.removeClass(this._activeList,'hiddenList');},getRoot:function(){return this._root;},getActiveList:function(){return this._activeList;},setActiveList:function(a){this._activeList=a;return this;},_handleClick:function(event){var c=event.getTarget();var b=Parent.byClass(c,'checkableListItem');if(!b)return;var a=Parent.byClass(c,'anchor');if(!a&&Parent.byTag(c,'a'))return;if(!CSS.hasClass(b,'disabledCheckable')){a&&event.prevent();this.inform('clickedCheckable',{item:b});event.stop();}},_listenForScroll:function(){if(this._windowTrigger){this._rootHeight=Vector2.getElementDimensions(this._root).y;if(this._rootHeight)this._scroll=Event.listen(window,'scroll',this._handleWindowScroll.bind(this));}else this._scroll=Event.listen(this._activeList,'scroll',this._handleListScroll.bind(this));},_handleWindowScroll:function(b){var a=this._rootHeight-Vector2.getScrollPosition().y;if(a<=ProfileBrowserListView.SCROLL_TRIGGER)this.inform('scrollTrigger');},_handleListScroll:function(b){var c=b.getTarget();var a=c.scrollHeight-c.scrollTop;if(ProfileBrowserListView.SCROLL_TRIGGER>a)this.inform('scrollTrigger');}});add_properties('ProfileBrowserListView',{SCROLL_TRIGGER:800});
function ProfileBrowserSelector(){}Class.mixin(ProfileBrowserSelector,'Arbiter',{init:function(a){this.selector=a;Selector.listen(a,'select',this.handle.bind(this));},handle:function(c){var a=DOM.find(c.option,'a');var d=a.getAttribute('data-target');var b=a.getAttribute('data-selectendpoint');var e=Selector.getOptionValue(c.option);if(d)this.inform('changeTarget',{target:d,value:e,isprimer:a.getAttribute('rel')=='async',showtypeahead:a.getAttribute('data-typeahead'),hubs:!!b});if(b)this.inform('changeHub',{value:e,placeholder:a.getAttribute('data-placeholder'),endpoint:b});},getSelectedValue:function(){return Selector.getValue(this.selector);},getSelectedAnchor:function(){return DOM.find(Selector.getSelectedOptions(this.selector)[0],'a');},setSelectedValue:function(a){Selector.setSelected(this.selector,a,true);}});
function ProfileBrowserTypeaheadCore(a){this.parent.construct(this,a);}Class.extend(ProfileBrowserTypeaheadCore,'TypeaheadCore');ProfileBrowserTypeaheadCore.prototype={keepFocused:false,initToggle:bagofholding,select:bagofholding};
function ProfileBrowserTypeaheadView(a,b){this.parent.construct(this,a,b);}Class.extend(ProfileBrowserTypeaheadView,'TypeaheadView');ProfileBrowserTypeaheadView.prototype={buildSummaryBox:function(c,a){var b;if(!a||!a.length){b=_tx("No results for: {search}",{search:c});}else if(a.length==1){b=_tx("Top result for: {search}",{search:c});}else b=_tx("Top {count} results for: {search}",{count:a.length,search:c});return $N('div',{className:'fbProfileBrowserSummaryBox phs pvm'},[b]);},render:function(b,a){this.results=a;DOM.setContent(this.element,[this.buildSummaryBox(b,a),this.buildResults(a)]);this.items=this.getItems();this.inform('render',a);},click:bagofholding,buildResults:function(b){var a=$N('div',{className:'fbProfileBrowserListContainer'},[$N('div',{className:'fbProfileBrowserList'},[this.parent.buildResults(b)])]);return a;},renderer:function(a){var b=$N('li',{className:'fbProfileBrowserListItem uiListItem uiListLight uiListVerticalItemBorder'},[$N('div',{className:'UIImageBlock clearfix UIImageBlock_Entity'},[$N('a',{className:'UIImageBlock_Image UIImageBlock_ENT_Image',tabindex:-1,href:a.path},[$N('img',{className:'img',src:a.photo})]),$N('div',{className:'UIImageBlock_Content UIImageBlock_ENT_Content'},[$N('div',{className:'fsl fwb fcb'},[$N('a',{href:a.path},[a.text])]),$N('div',{className:'fsm fwn fcg'},[a.category])])])]);return b;}};
function ProfileBrowserViewButtons(){}Class.mixin(ProfileBrowserViewButtons,'Arbiter',{init:function(a,c,b){this.root=a;this.buttons=DOM.scry(this.root,'.profileBrowserViewButton');this.searchView=b;this.selected=c;this.enabled=true;Event.listen(a,'click',this.handle.bind(this));},handle:function(event){if(!this.enabled)return;var b=event.getTarget();var a=Parent.byClass(b,'profileBrowserViewButton');if(CSS.hasClass(a,'uiButtonDepressed'))return;CSS.removeClass(this.selected,'uiButtonDepressed');this.selected=a;CSS.addClass(this.selected,'uiButtonDepressed');this.inform('swapView',{view:Button.getInputElement(this.selected).name});},setEnabled:function(a){this.enabled=a;this.buttons.each(function(b){Button.setEnabled(b,a);});}});